From 4306732e3b1b9513a9c4d69fe46818d326d55516 Mon Sep 17 00:00:00 2001
From: Alec Leamas <leamas.alec@gmail.com>
Date: Tue, 13 Jun 2017 23:05:38 +0200
Subject: [PATCH 1/3] python-pkg: tests: Don't hardcode socat and expect paths.

---
 python-pkg/tests/dummy-server   |  2 --
 python-pkg/tests/test_client.py | 17 ++++++++++++-----
 2 files changed, 12 insertions(+), 7 deletions(-)

diff --git a/python-pkg/tests/dummy-server b/python-pkg/tests/dummy-server
index a3d2ff7..80a283d 100755
--- a/python-pkg/tests/dummy-server
+++ b/python-pkg/tests/dummy-server
@@ -1,5 +1,3 @@
-#!/usr/bin/expect
-
 log_file -noappend backend.log
 
 remove_nulls
diff --git a/python-pkg/tests/test_client.py b/python-pkg/tests/test_client.py
index e0d1181..d9af254 100644
--- a/python-pkg/tests/test_client.py
+++ b/python-pkg/tests/test_client.py
@@ -20,7 +20,10 @@ import lirc
 _PACKET_ONE = '0123456789abcdef 00 KEY_1 mceusb'
 _LINE_0 = '0123456789abcdef 00 KEY_1 mceusb'
 _SOCKET = 'lircd.socket'
-_SOCAT = '/usr/bin/socat'
+_SOCAT = subprocess.check_output('which socat', shell=True) \
+    .decode('ascii').strip()
+_EXPECT = subprocess.check_output('which expect', shell=True) \
+    .decode('ascii').strip()
 
 
 def _wait_for_socket():
@@ -54,7 +57,8 @@ class ReceiveTests(unittest.TestCase):
 
         if os.path.exists(_SOCKET):
             os.unlink(_SOCKET)
-        cmd = [_SOCAT, 'UNIX-LISTEN:' + _SOCKET, 'EXEC:"./dummy-server 0"']
+        cmd = [_SOCAT, 'UNIX-LISTEN:' + _SOCKET,
+                'EXEC:"%s ./dummy-server 0"' % _EXPECT]
         with subprocess.Popen(cmd,
                               stdout = subprocess.PIPE,
                               stderr = subprocess.STDOUT) as child:
@@ -95,7 +99,8 @@ class ReceiveTests(unittest.TestCase):
 
         if os.path.exists(_SOCKET):
             os.unlink(_SOCKET)
-        cmd = [_SOCAT, 'UNIX-LISTEN:' + _SOCKET, 'EXEC:"./dummy-server 0"']
+        cmd = [_SOCAT, 'UNIX-LISTEN:' + _SOCKET,
+               'EXEC:"%s ./dummy-server 0"' % _EXPECT]
         lines = []
         with subprocess.Popen(cmd,
                               stdout = subprocess.PIPE,
@@ -134,7 +139,8 @@ class CommandTests(unittest.TestCase):
 
         if os.path.exists(_SOCKET):
             os.unlink(_SOCKET)
-        cmd = [_SOCAT, 'UNIX-LISTEN:' + _SOCKET, 'EXEC:"./dummy-server 100"']
+        cmd = [_SOCAT, 'UNIX-LISTEN:' + _SOCKET,
+               'EXEC:"%s ./dummy-server 100"' % _EXPECT]
         with subprocess.Popen(cmd,
                               stdout = subprocess.PIPE,
                               stderr = subprocess.STDOUT) as child:
@@ -152,7 +158,8 @@ class CommandTests(unittest.TestCase):
 
         if os.path.exists(_SOCKET):
             os.unlink(_SOCKET)
-        cmd = [_SOCAT, 'UNIX-LISTEN:' + _SOCKET, 'EXEC:"./dummy-server 100"']
+        cmd = [_SOCAT, 'UNIX-LISTEN:' + _SOCKET,
+               'EXEC:"%s ./dummy-server 100"' % _EXPECT]
         with subprocess.Popen(cmd,
                               stdout = subprocess.PIPE,
                               stderr = subprocess.STDOUT) as child:
-- 
2.9.3

